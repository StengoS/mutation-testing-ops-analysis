<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VideoSource.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pamvotis</a> &gt; <a href="index.source.html" class="el_package">pamvotis.sources</a> &gt; <span class="el_source">VideoSource.java</span></div><h1>VideoSource.java</h1><pre class="source lang-java linenums">package pamvotis.sources;

import pamvotis.core.VirtualPacket;

/**
 * Represents a source generating video traffic according to 3GPP TR 25.892
 * V6.0.0
 * 
 * @author Dimitris El. Vassis
 */
public class VideoSource extends Source {
<span class="nc" id="L12">	int _frameIntArr = 20;</span>
<span class="nc" id="L13">	int _packetsPerFrame = 8;</span>
<span class="nc" id="L14">	float _pktSize = 50 * 8;</span>
<span class="nc" id="L15">	float _pktSizeMax = 125 * 8;</span>
<span class="nc" id="L16">	int _pktIntArr = (int) (0.006 / slot);</span>
<span class="nc" id="L17">	int _pktIntArrMax = (int) (0.125 / slot);</span>
<span class="nc" id="L18">	int intArrCounter = 0;</span>
	static long timer;
<span class="nc" id="L20">	long _lastFrameCreation = 0;</span>

	/**
	 * Instantiates a video source according to specified parameters. See 3GPP
	 * TR 25.892 V6.0.0 for more details.
	 * 
	 * @param sourceId
	 *            The ID of the source
	 * @param frameRate
	 *            The video frame rate in frames/sec
	 * @param packetsPerFrame
	 *            The packets of a frame
	 * @param pktSize
	 *            The averaga size of each packet in bits
	 * @param pktSizeMax
	 *            The maximum size of each packet in bits
	 * @param pktIntArr
	 *            The average packet interarrival time in seconds (can be float
	 *            as well)
	 * @param pktIntArrMax
	 *            The maximum packet interarival interval in seconds (can be
	 *            float as well)
	 */
	public VideoSource(int sourceId, int frameRate, int packetsPerFrame,
			float pktSize, float pktSizeMax, float pktIntArr, float pktIntArrMax) {
<span class="nc" id="L45">		super(); // Call superclass constructor to assign an ID to pktSize</span>
					// source
<span class="nc" id="L47">		_sourceId = sourceId;</span>
<span class="nc" id="L48">		_frameIntArr = (int) (1f / frameRate / slot);</span>
<span class="nc" id="L49">		_packetsPerFrame = packetsPerFrame;</span>
<span class="nc" id="L50">		_pktSize = pktSize;</span>
<span class="nc" id="L51">		_pktSizeMax = pktSizeMax; // Note: At the moment, this parameter is not</span>
									// used, as pareto distrubution
		// is adopted, instead of truncated pareto recommended by 3GPP.
<span class="nc" id="L54">		_pktIntArr = (int) (pktIntArr / slot);</span>
<span class="nc" id="L55">		_pktIntArrMax = (int) (pktIntArrMax / slot); // Note: At the moment,</span>
														// this parameter is not
														// used, as pareto
														// distrubution
		// is adopted, instead of truncated pareto recommended by 3GPP.
<span class="nc" id="L60">		intArrCounter = _frameIntArr;</span>
<span class="nc" id="L61">		_lastFrameCreation = Source.timer;</span>
<span class="nc" id="L62">		createSession();</span>
<span class="nc" id="L63">	}</span>

	/**
	 * Creates a video session, according to the parameters of the constructor
	 */
	private void createSession() {
<span class="nc" id="L69">		RandomGenerator random = RandomGenerator.getInstance();</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">		for (int i = 0; i &lt; _packetsPerFrame; i++) {</span>
<span class="nc" id="L71">			session.addElement(new VirtualPacket((int) random.genRv(RandomGenerator.PARETO_DISTR, _pktSize,</span>
<span class="nc" id="L72">					_pktSizeMax, -1), (int) random.genRv(RandomGenerator.PARETO_DISTR, _pktIntArr,</span>
					_pktIntArrMax), i + 1));
		}
<span class="nc" id="L75">		intArrCounter = _frameIntArr;</span>
<span class="nc" id="L76">	}</span>

	/**
	 * If the session is not empty, it takes the first packet of the session in
	 * order to be born when its interarrival timer expires. If the session is
	 * empty, it just adds dummy packets, that actually represent an off
	 * interval.
	 */
	public void getNextPacket() {
<span class="nc bnc" id="L85" title="All 2 branches missed.">		if (!session.isEmpty()) {</span>
<span class="nc" id="L86">			interArTime = session.firstElement().interarrival;</span>
<span class="nc" id="L87">			pktLength = session.firstElement().length;</span>
<span class="nc" id="L88">			packetToBeTransmittedID = session.firstElement().id;</span>
<span class="nc" id="L89">			session.removeElementAt(0);</span>
		} else {
<span class="nc" id="L91">			interArTime = 1;</span>
<span class="nc" id="L92">			pktLength = 1;</span>
<span class="nc" id="L93">			packetToBeTransmittedID = -1;</span>
		}
<span class="nc" id="L95">	}</span>

	/**
	 * When the frame interarrival timer expires, a new session is created,
	 * which is actually a new frame.
	 */
	public void synchronize() {
<span class="nc bnc" id="L102" title="All 2 branches missed.">		if (Source.timer - _lastFrameCreation &gt;= _frameIntArr) {</span>
<span class="nc" id="L103">			_lastFrameCreation = Source.timer;</span>
<span class="nc" id="L104">			createSession();</span>
		}
<span class="nc" id="L106">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>